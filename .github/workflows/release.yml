name: Release

permissions:
    contents: write

on:
    push:
        tags:
        - v[0-9]+.*

jobs:
    create-release:
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@v3
        - uses: taiki-e/create-gh-release-action@v1
          with:
            token: ${{ secrets.GITHUB_TOKEN }}

    cargo-publish:
        runs-on: ubuntu-latest
        permissions:
          id-token: write
        steps:
        - uses: actions/checkout@v4
        - uses: rust-lang/crates-io-auth-action@v1
          id: auth
        - name: publish
          run: |
            rustup update stable
            cargo publish
          env:
            CARGO_REGISTRY_TOKEN: ${{ steps.auth.outputs.token }}
